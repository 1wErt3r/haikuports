SUMMARY="Portable, lightweight framework for the Objective-C language"
DESCRIPTION="ObjFW is a portable, lightweight framework for the Objective-C \
language. It enables you to write an application in Objective-C that will run \
on any platform supported by ObjFW without having to worry about differences \
between operating systems or various frameworks you would otherwise need if \
you want to be portable."
HOMEPAGE="https://objfw.nil.im/"
COPYRIGHT="2008-2023 Jonathan Schleifer"
LICENSE="QPL
	GNU GPL v2
	GNU GPL v3"
REVISION="1"
SOURCE_URI="https://objfw.nil.im/downloads/objfw-$portVersion.tar.gz"
CHECKSUM_SHA256="1c81d7d03578b2d9084fc5d8722d4eaa4bdc2f3f09ce41231e7ceab8212fae17"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

libobjfwVersion="1.0.1"
libobjfwVersionCompat="$libobjfwVersion compat >= 1.0"
libobjfwrtVersion="1.0.0"
libobjfwrtVersionCompat="$libobjfwrtVersion compat >= 1.0"
libobjfwtlsVersion="1.0.1"
libobjfwtlsVersionCompat="$libobjfwrtVersion compat >= 1.0"

PROVIDES="objfw$secondaryArchSuffix = $portVersion"
REQUIRES="
	objfw_libs$secondaryArchSuffix == $portVersion
	objfw_tls$secondaryArchSuffix == $portVersion
	objfw_utils$secondaryArchSuffix == $portVersion
	objfw_devel$secondaryArchSuffix == $portVersion
	"
BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libssl$secondaryArchSuffix
	llvm12_clang$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:gcc$secondaryArchSuffix
	cmd:make
	"

PROVIDES_libs="
	objfw_libs$secondaryArchSuffix = $portVersion
	lib:libobjfw$secondaryArchSuffix = $libobjfwVersionCompat
	lib:libobjfwrt$secondaryArchSuffix = $libobjfwrtVersionCompat
	"
REQUIRES_libs="
	haiku$secondaryArchSuffix
	"

PROVIDES_tls="
	objfw_tls$secondaryArchSuffix = $portVersion
	lib:libobjfwtls$secondaryArchSuffix = $libobjfwtlsVersionCompat
	"
REQUIRES_tls="
	haiku$secondaryArchSuffix
	lib:libobjfw$secondaryArchSuffix == $libobjfwVersionCompat
	lib:libobjfwrt$secondaryArchSuffix == $libobjfwrtVersionCompat
	lib:libcrypto$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	"

PROVIDES_utils="
	objfw_utils$secondaryArchSuffix = $portVersion
	cmd:ofarc$secondaryArchSuffix = $portVersion compat >= 1.0
	cmd:ofdns$secondaryArchSuffix = $portVersion compat >= 1.0
	cmd:ofhash$secondaryArchSuffix = $portVersion compat >= 1.0
	cmd:ofhttp$secondaryArchSuffix = $portVersion compat >= 1.0
	"
REQUIRES_utils="
	haiku$secondaryArchSuffix
	lib:libobjfw$secondaryArchSuffix == $libobjfwVersionCompat
	lib:libobjfwrt$secondaryArchSuffix == $libobjfwrtVersionCompat
	lib:libobjfwtls$secondaryArchSuffix == $libobjfwtlsVersionCompat
	lib:libcrypto$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
	"

PROVIDES_devel="
	objfw_devel$secondaryArchSuffix = $portVersion
	cmd:objfw_compile$secondaryArchSuffix = $portVersion compat >= 1.0
	cmd:objfw_config$secondaryArchSuffix = $portVersion compat >= 1.0
	cmd:objfw_embed$secondaryArchSuffix = $portVersion compat >= 1.0
	cmd:objfw_new$secondaryArchSuffix = $portVersion compat >= 1.0
	devel:libobjfw$secondaryArchSuffix = $libobjfwVersionCompat
	devel:libobjfwrt$secondaryArchSuffix = $libobjfwrtVersionCompat
	devel:libobjfwtls$secondaryArchSuffix = $libobjfwtlsVersionCompat
	"
REQUIRES_devel="
	haiku$secondaryArchSuffix
	lib:libobjfw$secondaryArchSuffix == $libobjfwVersionCompat
	lib:libobjfwrt$secondaryArchSuffix == $libobjfwrtVersionCompat
	lib:libobjfwtls$secondaryArchSuffix == $libobjfwtlsVersionCompat
	"

BUILD()
{
	runConfigure ./configure
	make $jobArgs
}

INSTALL()
{
	make install

	packageEntries libs \
		$libDir/libobjfw.so* \
		$libDir/libobjfwrt.so*
	packageEntries tls $libDir/libobjfwtls.so*
	packageEntries utils \
		$binDir/ofarc $dataDir/ofarc \
		$binDir/ofdns $dataDir/ofdns \
		$binDir/ofhash $dataDir/ofhash \
		$binDir/ofhttp $dataDir/ofhttp
	packageEntries devel \
		$binDir/objfw-compile \
		$binDir/objfw-config \
		$binDir/objfw-embed \
		$binDir/objfw-new \
		$developDir
}

TEST()
{
	make check
}
